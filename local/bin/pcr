#!/usr/bin/env python

import os
import time

from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.support.ui import Select

driver = webdriver.Chrome()
driver.implicitly_wait(5)
driver.get(
    "https://c19-react.imperial.ac.uk/apex/booking/r/c19110120100/1?session=10399471030507#"
)

USERNAME = os.environ["IMPERIAL_USERNAME"]
PASSWORD = os.environ["IMPERIAL_PASSWORD"]
CID = os.environ["IMPERIAL_CID"]
PASSPORT = os.environ["PASSPORT_NUMBER"]
PHONE = os.environ["PHONE_NUMBER"]

driver.find_element_by_css_selector("input[type='email']").send_keys(
    f"{USERNAME}@ic.ac.uk"
)
driver.find_element_by_css_selector("input[type='submit']").click()
time.sleep(2)
driver.find_element_by_css_selector("input[type='password']").send_keys(
    PASSWORD
)
driver.find_element_by_css_selector("input[type='submit']").click()
time.sleep(1)
driver.find_element_by_css_selector("input[type='submit']").click()
time.sleep(1)
driver.find_element(value="B63982746532132935").click()

driver.find_element_by_css_selector("input[placeholder='CID']").send_keys(CID)
driver.find_element_by_css_selector(
    "input[placeholder='DD/MM/YYYY']"
).send_keys("31/01/1994")
# Next button
driver.find_element_by_css_selector(
    "button[class='t-Button t-Button--icon t-Button--large t-Button--success t-Button--iconRight t-Button--hot']"
).click()

driver.find_element(value="P110_PHONE").send_keys(PHONE)
driver.find_element(value="P110_POSTCODE_lov_btn").click()
element = driver.switch_to.active_element
element.send_keys("W8 6SU")
time.sleep(2)
element.send_keys(Keys.DOWN)
element.send_keys(Keys.ENTER)
Select(driver.find_element(value="P110_ADDRESS_ID")).select_by_visible_text(
    "Flat 9, 147-149, Kensington High Street Kensington and Chelsea, LONDON, W8 6SU"
)
# Next button
driver.find_element_by_css_selector(
    "button[class='t-Button t-Button--icon t-Button--large t-Button--success t-Button--iconRight t-Button--gapLeft t-Button--hot']"
).click()

driver.find_element(value="P120_PASSPORT_NO").send_keys(PASSPORT)
driver.find_element_by_css_selector(
    "button[class='t-Button t-Button--icon t-Button--large t-Button--success t-Button--iconRight t-Button--gapLeft t-Button--hot']"
).click()
for elem in driver.find_elements_by_css_selector("label[class='u-checkbox']"):
    elem.click()
driver.find_element_by_css_selector(
    "button[class='t-Button t-Button--icon t-Button--large t-Button--success t-Button--iconRight t-Button--gapLeft t-Button--hot']"
).click()
driver.find_element_by_css_selector("label[for='calendar-4545712']").click()
