#!/usr/bin/env python3

import argparse
import os.path as osp

import PIL.Image

import imgviz


def main():
    parser = argparse.ArgumentParser(
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    parser.add_argument("image_files", nargs="+")
    args = parser.parse_args()

    images = [PIL.Image.open(image_file) for image_file in args.image_files]

    marked = set()
    if osp.exists("marked.txt"):
        print("==> Loading from: marked.txt")
        with open("marked.txt") as f:
            for filename in f:
                marked.add(filename.strip())

    def mark(images, index):
        filename = images[index].filename
        if filename in marked:
            return

        print("{} >> marked.txt".format(filename))
        with open("marked.txt", "a") as f:
            f.write(filename + "\n")
        marked.add(filename)

    keymap = {
        "m": mark,
    }

    imgviz.io.pyglet_imshow(images, keymap=keymap)
    imgviz.io.pyglet_run()


if __name__ == "__main__":
    main()
