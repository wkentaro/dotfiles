#!/usr/bin/env python3

import argparse
import os.path as osp

import imgviz


def main():
    parser = argparse.ArgumentParser(
        formatter_class=argparse.ArgumentDefaultsHelpFormatter
    )
    parser.add_argument("image_files", nargs="+")
    args = parser.parse_args()

    marked = set()
    if osp.exists("marked.txt"):
        print("==> Loading from: marked.txt")
        with open("marked.txt") as f:
            for filename in f:
                marked.add(filename.strip())

    def mark(images, index):
        filename = images[index]
        if filename in marked:
            return

        print("{} >> marked.txt".format(filename))
        with open("marked.txt", "a") as f:
            f.write(filename + "\n")
        marked.add(filename)

    keymap = {
        "m": mark,
    }

    imgviz.io.pyglet_imshow(
        image=args.image_files, keymap=keymap, hook=imgviz.io.imread
    )
    imgviz.io.pyglet_run()


if __name__ == "__main__":
    main()
